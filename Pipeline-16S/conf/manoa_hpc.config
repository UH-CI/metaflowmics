/*
 * -------------------------------------------------
 *  University of Hawaii at Manoa cluster config file
 * -------------------------------------------------
 * 
 */

executor{
   jobName = { "$task.tag" }
   queueSize = 20
}

params {
  referenceAln = "${PWD}/databases/silva.nr_v132.align"
  referenceTax = "${PWD}/databases/silva.full_v132.tax"  
}

env{
   PYTHONPATH="${PWD}/python-packages/:${PYTHONPATH}"
   R_LIBS_USER="${PWD}/R-packages"  
}

process {
   executor = 'slurm'
   stageInMode = 'symlink'
   stageOutMode = 'rsync'
   queue = 'shared'

   withLabel: low_computation {
   	      cpus = 4
	      memory = 16.GB
	      time = '1h'
	      queue = 'shared,exclusive,kill-shared'
	      }

   withLabel: medium_computation {
   	      cpus = 10
	      memory = 32.GB
	      time = '3h'
	      queue = 'shared,exclusive,kill-shared'
	      }
   withLabel: high_computation {
   	      cpus = 19
	      memory = 120.GB
	      time = '1d'
	      queue = 'shared,exclusive,kill-shared'
   }	      
}	

process {
   withName: FilterAndTrim {
   	     module="lang/R/3.5.1-intel-2018.5.274-Python-2.7.15"
   }
   withName: LearnErrors {
   	     module="lang/R/3.5.1-intel-2018.5.274-Python-2.7.15"
   }
   withName: Denoise {
   	     module="lang/R/3.5.1-intel-2018.5.274-Python-2.7.15"
   }
   withName: Esv {
   	     module="lang/R/3.5.1-intel-2018.5.274-Python-2.7.15"
   }   
   withName: MultipleSequenceAlignment {
             beforeScript="module purge"
   	     module="bio/Mothur/1.42.0-foss-2018b-Python-2.7.15"
   }
   withName: ChimeraRemoval {
             beforeScript="module purge"   
   	     module=["bio/Mothur/1.42.0-foss-2018b-Python-2.7.15",
	             "bio/VSEARCH/2.11.1"]
   }
   withName: Subsampling {
             beforeScript="module purge"   
   	     module="bio/Mothur/1.42.0-foss-2018b-Python-2.7.15"
   }
   withName: Clustering {
             beforeScript="module purge" 
   	     module=["bio/Mothur/1.42.0-foss-2018b-Python-2.7.15",
		     "bio/VSEARCH/2.11.1"]
   }
   withName: ConsensusClassification {
             beforeScript="module purge"   
   	     module="bio/Mothur/1.42.0-foss-2018b-Python-2.7.15"
   }
   withName: PreLulu {
   	     module="bio/VSEARCH/2.11.1"
   }
   withName: Lulu {
   	     module="lang/R/3.5.1-intel-2018.5.274-Python-2.7.15"
   }
   withName: SingletonFilter {
   	     module="lang/Python/3.7.2-GCCcore-8.2.0"
   }
   withName: TaxaFilter {
             beforeScript="module purge"   
   	     module="bio/Mothur/1.42.0-foss-2018b-Python-2.7.15"
   }
   withName: Results {
             beforeScript="module purge"   
   	     module="bio/Mothur/1.42.0-foss-2018b-Python-2.7.15"
   }
   withName: SummaryFile {
   	     module="lang/Python/3.7.2-GCCcore-8.2.0"
   }

}

